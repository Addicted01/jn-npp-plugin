#summary Describes how to call Win32 API functions from JavaScript
#labels Featured

= Calling of Win32 API functions =
jN provides very powerful API working with Notepad++ and its views. But some times it is necessary to use Win32 API directly to get more inside or outside of Notepad++.

== The simplest call ==
We begin with the simplest call. It is [http://msdn.microsoft.com/en-us/library/windows/desktop/ms645505.aspx MessageBoxW] defined in user32.dll

{{{
function MessageBox(caption, text){
  var lib = System.loadLibrary("user32.dll");
  var paramBuf = lib.alloc( 4 * 4);

  lib.writeDWord(paramBuf, 0,  0);
  lib.writeDWord(paramBuf, 4,  text);
  lib.writeDWord(paramBuf, 8,  caption);
  lib.writeDWord(paramBuf, 12, 0);

  lib.call("MessageBoxW", paramBuf);
}
}}}
Now we can call our native MessageBox as follows 
{{{
MessageBox("Title of Box", "My important message");
}}}
What is happened? First of all we load user32.dll. Then we allocate buffer for all parameters of function to be called. In our case MessageBox has 4 "Int32" parameters. We put parameter values into buffer. At the end we use call method of library instance to call MessageBoxW. It is unicode version of MessageBox. Call method looks for  pointer to MessageBoxW in user32.dll, copies paramBuf on stack and then calls pointed function. 

== Using of callback functions ==
TODO

== Some thoughts about memory usage ==
TODO